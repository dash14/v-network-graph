import{w as vt,a7 as yt}from"./ui.DJLPJrBF.js";function et(t,n){var e,r=1;t==null&&(t=0),n==null&&(n=0);function i(){var o,l=e.length,a,h=0,f=0;for(o=0;o<l;++o)a=e[o],h+=a.x,f+=a.y;for(h=(h/l-t)*r,f=(f/l-n)*r,o=0;o<l;++o)a=e[o],a.x-=h,a.y-=f}return i.initialize=function(o){e=o},i.x=function(o){return arguments.length?(t=+o,i):t},i.y=function(o){return arguments.length?(n=+o,i):n},i.strength=function(o){return arguments.length?(r=+o,i):r},i}function gt(t){const n=+this._x.call(null,t),e=+this._y.call(null,t);return rt(this.cover(n,e),n,e,t)}function rt(t,n,e,r){if(isNaN(n)||isNaN(e))return t;var i,o=t._root,l={data:r},a=t._x0,h=t._y0,f=t._x1,y=t._y1,_,x,v,g,c,u,s,p;if(!o)return t._root=l,t;for(;o.length;)if((c=n>=(_=(a+f)/2))?a=_:f=_,(u=e>=(x=(h+y)/2))?h=x:y=x,i=o,!(o=o[s=u<<1|c]))return i[s]=l,t;if(v=+t._x.call(null,o.data),g=+t._y.call(null,o.data),n===v&&e===g)return l.next=o,i?i[s]=l:t._root=l,t;do i=i?i[s]=new Array(4):t._root=new Array(4),(c=n>=(_=(a+f)/2))?a=_:f=_,(u=e>=(x=(h+y)/2))?h=x:y=x;while((s=u<<1|c)===(p=(g>=x)<<1|v>=_));return i[p]=o,i[s]=l,t}function pt(t){var n,e,r=t.length,i,o,l=new Array(r),a=new Array(r),h=1/0,f=1/0,y=-1/0,_=-1/0;for(e=0;e<r;++e)isNaN(i=+this._x.call(null,n=t[e]))||isNaN(o=+this._y.call(null,n))||(l[e]=i,a[e]=o,i<h&&(h=i),i>y&&(y=i),o<f&&(f=o),o>_&&(_=o));if(h>y||f>_)return this;for(this.cover(h,f).cover(y,_),e=0;e<r;++e)rt(this,l[e],a[e],t[e]);return this}function xt(t,n){if(isNaN(t=+t)||isNaN(n=+n))return this;var e=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(e))i=(e=Math.floor(t))+1,o=(r=Math.floor(n))+1;else{for(var l=i-e||1,a=this._root,h,f;e>t||t>=i||r>n||n>=o;)switch(f=(n<r)<<1|t<e,h=new Array(4),h[f]=a,a=h,l*=2,f){case 0:i=e+l,o=r+l;break;case 1:e=i-l,o=r+l;break;case 2:i=e+l,r=o-l;break;case 3:e=i-l,r=o-l;break}this._root&&this._root.length&&(this._root=a)}return this._x0=e,this._y0=r,this._x1=i,this._y1=o,this}function dt(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t}function wt(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function j(t,n,e,r,i){this.node=t,this.x0=n,this.y0=e,this.x1=r,this.y1=i}function _t(t,n,e){var r,i=this._x0,o=this._y0,l,a,h,f,y=this._x1,_=this._y1,x=[],v=this._root,g,c;for(v&&x.push(new j(v,i,o,y,_)),e==null?e=1/0:(i=t-e,o=n-e,y=t+e,_=n+e,e*=e);g=x.pop();)if(!(!(v=g.node)||(l=g.x0)>y||(a=g.y0)>_||(h=g.x1)<i||(f=g.y1)<o))if(v.length){var u=(l+h)/2,s=(a+f)/2;x.push(new j(v[3],u,s,h,f),new j(v[2],l,s,u,f),new j(v[1],u,a,h,s),new j(v[0],l,a,u,s)),(c=(n>=s)<<1|t>=u)&&(g=x[x.length-1],x[x.length-1]=x[x.length-1-c],x[x.length-1-c]=g)}else{var p=t-+this._x.call(null,v.data),w=n-+this._y.call(null,v.data),d=p*p+w*w;if(d<e){var m=Math.sqrt(e=d);i=t-m,o=n-m,y=t+m,_=n+m,r=v.data}}return r}function mt(t){if(isNaN(y=+this._x.call(null,t))||isNaN(_=+this._y.call(null,t)))return this;var n,e=this._root,r,i,o,l=this._x0,a=this._y0,h=this._x1,f=this._y1,y,_,x,v,g,c,u,s;if(!e)return this;if(e.length)for(;;){if((g=y>=(x=(l+h)/2))?l=x:h=x,(c=_>=(v=(a+f)/2))?a=v:f=v,n=e,!(e=e[u=c<<1|g]))return this;if(!e.length)break;(n[u+1&3]||n[u+2&3]||n[u+3&3])&&(r=n,s=u)}for(;e.data!==t;)if(i=e,!(e=e.next))return this;return(o=e.next)&&delete e.next,i?(o?i.next=o:delete i.next,this):n?(o?n[u]=o:delete n[u],(e=n[0]||n[1]||n[2]||n[3])&&e===(n[3]||n[2]||n[1]||n[0])&&!e.length&&(r?r[s]=e:this._root=e),this):(this._root=o,this)}function Nt(t){for(var n=0,e=t.length;n<e;++n)this.remove(t[n]);return this}function bt(){return this._root}function At(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t}function Mt(t){var n=[],e,r=this._root,i,o,l,a,h;for(r&&n.push(new j(r,this._x0,this._y0,this._x1,this._y1));e=n.pop();)if(!t(r=e.node,o=e.x0,l=e.y0,a=e.x1,h=e.y1)&&r.length){var f=(o+a)/2,y=(l+h)/2;(i=r[3])&&n.push(new j(i,f,y,a,h)),(i=r[2])&&n.push(new j(i,o,y,f,h)),(i=r[1])&&n.push(new j(i,f,l,a,y)),(i=r[0])&&n.push(new j(i,o,l,f,y))}return this}function jt(t){var n=[],e=[],r;for(this._root&&n.push(new j(this._root,this._x0,this._y0,this._x1,this._y1));r=n.pop();){var i=r.node;if(i.length){var o,l=r.x0,a=r.y0,h=r.x1,f=r.y1,y=(l+h)/2,_=(a+f)/2;(o=i[0])&&n.push(new j(o,l,a,y,_)),(o=i[1])&&n.push(new j(o,y,a,h,_)),(o=i[2])&&n.push(new j(o,l,_,y,f)),(o=i[3])&&n.push(new j(o,y,_,h,f))}e.push(r)}for(;r=e.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function Ot(t){return t[0]}function Lt(t){return arguments.length?(this._x=t,this):this._x}function zt(t){return t[1]}function kt(t){return arguments.length?(this._y=t,this):this._y}function H(t,n,e){var r=new W(n??Ot,e??zt,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function W(t,n,e,r,i,o){this._x=t,this._y=n,this._x0=e,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function G(t){for(var n={data:t.data},e=n;t=t.next;)e=e.next={data:t.data};return n}var O=H.prototype=W.prototype;O.copy=function(){var t=new W(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root,e,r;if(!n)return t;if(!n.length)return t._root=G(n),t;for(e=[{source:n,target:t._root=new Array(4)}];n=e.pop();)for(var i=0;i<4;++i)(r=n.source[i])&&(r.length?e.push({source:r,target:n.target[i]=new Array(4)}):n.target[i]=G(r));return t};O.add=gt;O.addAll=pt;O.cover=xt;O.data=dt;O.extent=wt;O.find=_t;O.remove=mt;O.removeAll=Nt;O.root=bt;O.size=At;O.visit=Mt;O.visitAfter=jt;O.x=Lt;O.y=kt;function N(t){return function(){return t}}function S(t){return(t()-.5)*1e-6}function Et(t){return t.x+t.vx}function Tt(t){return t.y+t.vy}function it(t){var n,e,r,i=1,o=1;typeof t!="function"&&(t=N(t==null?1:+t));function l(){for(var f,y=n.length,_,x,v,g,c,u,s=0;s<o;++s)for(_=H(n,Et,Tt).visitAfter(a),f=0;f<y;++f)x=n[f],c=e[x.index],u=c*c,v=x.x+x.vx,g=x.y+x.vy,_.visit(p);function p(w,d,m,b,L){var A=w.data,z=w.r,M=c+z;if(A){if(A.index>x.index){var E=v-A.x-A.vx,T=g-A.y-A.vy,k=E*E+T*T;k<M*M&&(E===0&&(E=S(r),k+=E*E),T===0&&(T=S(r),k+=T*T),k=(M-(k=Math.sqrt(k)))/k*i,x.vx+=(E*=k)*(M=(z*=z)/(u+z)),x.vy+=(T*=k)*M,A.vx-=E*(M=1-M),A.vy-=T*M)}return}return d>v+M||b<v-M||m>g+M||L<g-M}}function a(f){if(f.data)return f.r=e[f.data.index];for(var y=f.r=0;y<4;++y)f[y]&&f[y].r>f.r&&(f.r=f[y].r)}function h(){if(n){var f,y=n.length,_;for(e=new Array(y),f=0;f<y;++f)_=n[f],e[_.index]=+t(_,f,n)}}return l.initialize=function(f,y){n=f,r=y,h()},l.iterations=function(f){return arguments.length?(o=+f,l):o},l.strength=function(f){return arguments.length?(i=+f,l):i},l.radius=function(f){return arguments.length?(t=typeof f=="function"?f:N(+f),h(),l):t},l}function St(t){return t.index}function J(t,n){var e=t.get(n);if(!e)throw new Error("node not found: "+n);return e}function ot(t){var n=St,e=_,r,i=N(30),o,l,a,h,f,y=1;t==null&&(t=[]);function _(u){return 1/Math.min(a[u.source.index],a[u.target.index])}function x(u){for(var s=0,p=t.length;s<y;++s)for(var w=0,d,m,b,L,A,z,M;w<p;++w)d=t[w],m=d.source,b=d.target,L=b.x+b.vx-m.x-m.vx||S(f),A=b.y+b.vy-m.y-m.vy||S(f),z=Math.sqrt(L*L+A*A),z=(z-o[w])/z*u*r[w],L*=z,A*=z,b.vx-=L*(M=h[w]),b.vy-=A*M,m.vx+=L*(M=1-M),m.vy+=A*M}function v(){if(l){var u,s=l.length,p=t.length,w=new Map(l.map((m,b)=>[n(m,b,l),m])),d;for(u=0,a=new Array(s);u<p;++u)d=t[u],d.index=u,typeof d.source!="object"&&(d.source=J(w,d.source)),typeof d.target!="object"&&(d.target=J(w,d.target)),a[d.source.index]=(a[d.source.index]||0)+1,a[d.target.index]=(a[d.target.index]||0)+1;for(u=0,h=new Array(p);u<p;++u)d=t[u],h[u]=a[d.source.index]/(a[d.source.index]+a[d.target.index]);r=new Array(p),g(),o=new Array(p),c()}}function g(){if(l)for(var u=0,s=t.length;u<s;++u)r[u]=+e(t[u],u,t)}function c(){if(l)for(var u=0,s=t.length;u<s;++u)o[u]=+i(t[u],u,t)}return x.initialize=function(u,s){l=u,f=s,v()},x.links=function(u){return arguments.length?(t=u,v(),x):t},x.id=function(u){return arguments.length?(n=u,x):n},x.iterations=function(u){return arguments.length?(y=+u,x):y},x.strength=function(u){return arguments.length?(e=typeof u=="function"?u:N(+u),g(),x):e},x.distance=function(u){return arguments.length?(i=typeof u=="function"?u:N(+u),c(),x):i},x}var Dt={value:()=>{}};function at(){for(var t=0,n=arguments.length,e={},r;t<n;++t){if(!(r=arguments[t]+"")||r in e||/[\s.]/.test(r))throw new Error("illegal type: "+r);e[r]=[]}return new R(e)}function R(t){this._=t}function It(t,n){return t.trim().split(/^|\s+/).map(function(e){var r="",i=e.indexOf(".");if(i>=0&&(r=e.slice(i+1),e=e.slice(0,i)),e&&!n.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:r}})}R.prototype=at.prototype={constructor:R,on:function(t,n){var e=this._,r=It(t+"",e),i,o=-1,l=r.length;if(arguments.length<2){for(;++o<l;)if((i=(t=r[o]).type)&&(i=Pt(e[i],t.name)))return i;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++o<l;)if(i=(t=r[o]).type)e[i]=U(e[i],t.name,n);else if(n==null)for(i in e)e[i]=U(e[i],t.name,null);return this},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new R(t)},call:function(t,n){if((i=arguments.length-2)>0)for(var e=new Array(i),r=0,i,o;r<i;++r)e[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(n,e)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(n,e)}};function Pt(t,n){for(var e=0,r=t.length,i;e<r;++e)if((i=t[e]).name===n)return i.value}function U(t,n,e){for(var r=0,i=t.length;r<i;++r)if(t[r].name===n){t[r]=Dt,t=t.slice(0,r).concat(t.slice(r+1));break}return e!=null&&t.push({name:n,value:e}),t}var I=0,$=0,P=0,ft=1e3,C,F,K=0,D=0,Q=0,B=typeof performance=="object"&&performance.now?performance:Date,ut=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function st(){return D||(ut($t),D=B.now()+Q)}function $t(){D=0}function X(){this._call=this._time=this._next=null}X.prototype=lt.prototype={constructor:X,restart:function(t,n,e){if(typeof t!="function")throw new TypeError("callback is not a function");e=(e==null?st():+e)+(n==null?0:+n),!this._next&&F!==this&&(F?F._next=this:C=this,F=this),this._call=t,this._time=e,Y()},stop:function(){this._call&&(this._call=null,this._time=1/0,Y())}};function lt(t,n,e){var r=new X;return r.restart(t,n,e),r}function Ft(){st(),++I;for(var t=C,n;t;)(n=D-t._time)>=0&&t._call.call(void 0,n),t=t._next;--I}function V(){D=(K=B.now())+Q,I=$=0;try{Ft()}finally{I=0,Rt(),D=0}}function Bt(){var t=B.now(),n=t-K;n>ft&&(Q-=n,K=t)}function Rt(){for(var t,n=C,e,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:C=e);F=t,Y(r)}function Y(t){if(!I){$&&($=clearTimeout($));var n=t-D;n>24?(t<1/0&&($=setTimeout(V,t-B.now()-Q)),P&&(P=clearInterval(P))):(P||(K=B.now(),P=setInterval(Bt,ft)),I=1,ut(V))}}const Ct=1664525,Kt=1013904223,Z=4294967296;function Qt(){let t=1;return()=>(t=(Ct*t+Kt)%Z)/Z}function Xt(t){return t.x}function Yt(t){return t.y}var Ht=10,Wt=Math.PI*(3-Math.sqrt(5));function ct(t){var n,e=1,r=.001,i=1-Math.pow(r,1/300),o=0,l=.6,a=new Map,h=lt(_),f=at("tick","end"),y=Qt();t==null&&(t=[]);function _(){x(),f.call("tick",n),e<r&&(h.stop(),f.call("end",n))}function x(c){var u,s=t.length,p;c===void 0&&(c=1);for(var w=0;w<c;++w)for(e+=(o-e)*i,a.forEach(function(d){d(e)}),u=0;u<s;++u)p=t[u],p.fx==null?p.x+=p.vx*=l:(p.x=p.fx,p.vx=0),p.fy==null?p.y+=p.vy*=l:(p.y=p.fy,p.vy=0);return n}function v(){for(var c=0,u=t.length,s;c<u;++c){if(s=t[c],s.index=c,s.fx!=null&&(s.x=s.fx),s.fy!=null&&(s.y=s.fy),isNaN(s.x)||isNaN(s.y)){var p=Ht*Math.sqrt(.5+c),w=c*Wt;s.x=p*Math.cos(w),s.y=p*Math.sin(w)}(isNaN(s.vx)||isNaN(s.vy))&&(s.vx=s.vy=0)}}function g(c){return c.initialize&&c.initialize(t,y),c}return v(),n={tick:x,restart:function(){return h.restart(_),n},stop:function(){return h.stop(),n},nodes:function(c){return arguments.length?(t=c,v(),a.forEach(g),n):t},alpha:function(c){return arguments.length?(e=+c,n):e},alphaMin:function(c){return arguments.length?(r=+c,n):r},alphaDecay:function(c){return arguments.length?(i=+c,n):+i},alphaTarget:function(c){return arguments.length?(o=+c,n):o},velocityDecay:function(c){return arguments.length?(l=1-c,n):1-l},randomSource:function(c){return arguments.length?(y=c,a.forEach(g),n):y},force:function(c,u){return arguments.length>1?(u==null?a.delete(c):a.set(c,g(u)),n):a.get(c)},find:function(c,u,s){var p=0,w=t.length,d,m,b,L,A;for(s==null?s=1/0:s*=s,p=0;p<w;++p)L=t[p],d=c-L.x,m=u-L.y,b=d*d+m*m,b<s&&(A=L,s=b);return A},on:function(c,u){return arguments.length>1?(f.on(c,u),n):f.on(c)}}}function ht(){var t,n,e,r,i=N(-30),o,l=1,a=1/0,h=.81;function f(v){var g,c=t.length,u=H(t,Xt,Yt).visitAfter(_);for(r=v,g=0;g<c;++g)n=t[g],u.visit(x)}function y(){if(t){var v,g=t.length,c;for(o=new Array(g),v=0;v<g;++v)c=t[v],o[c.index]=+i(c,v,t)}}function _(v){var g=0,c,u,s=0,p,w,d;if(v.length){for(p=w=d=0;d<4;++d)(c=v[d])&&(u=Math.abs(c.value))&&(g+=c.value,s+=u,p+=u*c.x,w+=u*c.y);v.x=p/s,v.y=w/s}else{c=v,c.x=c.data.x,c.y=c.data.y;do g+=o[c.data.index];while(c=c.next)}v.value=g}function x(v,g,c,u){if(!v.value)return!0;var s=v.x-n.x,p=v.y-n.y,w=u-g,d=s*s+p*p;if(w*w/h<d)return d<a&&(s===0&&(s=S(e),d+=s*s),p===0&&(p=S(e),d+=p*p),d<l&&(d=Math.sqrt(l*d)),n.vx+=s*v.value*r/d,n.vy+=p*v.value*r/d),!0;if(v.length||d>=a)return;(v.data!==n||v.next)&&(s===0&&(s=S(e),d+=s*s),p===0&&(p=S(e),d+=p*p),d<l&&(d=Math.sqrt(l*d)));do v.data!==n&&(w=o[v.data.index]*r/d,n.vx+=s*w,n.vy+=p*w);while(v=v.next)}return f.initialize=function(v,g){t=v,e=g,y()},f.strength=function(v){return arguments.length?(i=typeof v=="function"?v:N(+v),y(),f):i},f.distanceMin=function(v){return arguments.length?(l=v*v,f):Math.sqrt(l)},f.distanceMax=function(v){return arguments.length?(a=v*v,f):Math.sqrt(a)},f.theta=function(v){return arguments.length?(h=v*v,f):Math.sqrt(h)},f}function Gt(t,n,e){var r,i=N(.1),o,l;typeof t!="function"&&(t=N(+t)),n==null&&(n=0),e==null&&(e=0);function a(f){for(var y=0,_=r.length;y<_;++y){var x=r[y],v=x.x-n||1e-6,g=x.y-e||1e-6,c=Math.sqrt(v*v+g*g),u=(l[y]-c)*o[y]*f/c;x.vx+=v*u,x.vy+=g*u}}function h(){if(r){var f,y=r.length;for(o=new Array(y),l=new Array(y),f=0;f<y;++f)l[f]=+t(r[f],f,r),o[f]=isNaN(l[f])?0:+i(r[f],f,r)}}return a.initialize=function(f){r=f,h()},a.strength=function(f){return arguments.length?(i=typeof f=="function"?f:N(+f),h(),a):i},a.radius=function(f){return arguments.length?(t=typeof f=="function"?f:N(+f),h(),a):t},a.x=function(f){return arguments.length?(n=+f,a):n},a.y=function(f){return arguments.length?(e=+f,a):e},a}function Jt(t){var n=N(.1),e,r,i;typeof t!="function"&&(t=N(t==null?0:+t));function o(a){for(var h=0,f=e.length,y;h<f;++h)y=e[h],y.vx+=(i[h]-y.x)*r[h]*a}function l(){if(e){var a,h=e.length;for(r=new Array(h),i=new Array(h),a=0;a<h;++a)r[a]=isNaN(i[a]=+t(e[a],a,e))?0:+n(e[a],a,e)}}return o.initialize=function(a){e=a,l()},o.strength=function(a){return arguments.length?(n=typeof a=="function"?a:N(+a),l(),o):n},o.x=function(a){return arguments.length?(t=typeof a=="function"?a:N(+a),l(),o):t},o}function Ut(t){var n=N(.1),e,r,i;typeof t!="function"&&(t=N(t==null?0:+t));function o(a){for(var h=0,f=e.length,y;h<f;++h)y=e[h],y.vy+=(i[h]-y.y)*r[h]*a}function l(){if(e){var a,h=e.length;for(r=new Array(h),i=new Array(h),a=0;a<h;++a)r[a]=isNaN(i[a]=+t(e[a],a,e))?0:+n(e[a],a,e)}}return o.initialize=function(a){e=a,l()},o.strength=function(a){return arguments.length?(n=typeof a=="function"?a:N(+a),l(),o):n},o.y=function(a){return arguments.length?(t=typeof a=="function"?a:N(+a),l(),o):t},o}const Vt=Object.freeze(Object.defineProperty({__proto__:null,forceCenter:et,forceCollide:it,forceLink:ot,forceManyBody:ht,forceRadial:Gt,forceSimulation:ct,forceX:Jt,forceY:Ut},Symbol.toStringTag,{value:"Module"}));var Zt=Object.defineProperty,qt=Object.defineProperties,tn=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,nn=Object.prototype.hasOwnProperty,en=Object.prototype.propertyIsEnumerable,tt=(t,n,e)=>n in t?Zt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,nt=(t,n)=>{for(var e in n||(n={}))nn.call(n,e)&&tt(t,e,n[e]);if(q)for(var e of q(n))en.call(n,e)&&tt(t,e,n[e]);return t},rn=(t,n)=>qt(t,tn(n));class an{constructor(n={}){this.options=n}activate(n){const{nodePositions:e,nodes:r,edges:i,emitter:o}=n;let{nodeLayouts:l,nodeLayoutMap:a}=this.buildNodeLayouts(r.value,e);const h=this.createSimulation(l,this.forceLayoutEdges(i.value,r.value));this.onTick=()=>{var g,c,u,s,p;for(const w of l){const d=(g=e.value)==null?void 0:g[w.id];if(d){const m=(c=w.x)!=null?c:0,b=(u=w.y)!=null?u:0;(d.x!==m||d.y!==b)&&Object.assign(d,{x:m,y:b})}else e.value[w.id]={x:(s=w.x)!=null?s:0,y:(p=w.y)!=null?p:0}}},h.on("tick",this.onTick),this.onTick();const f=()=>{this.options.noAutoRestartSimulation||h.alpha(.1).restart()},y=g=>{var c;if(this.options.noAutoRestartSimulation)for(const[u,s]of Object.entries(g)){const p=(c=e.value)==null?void 0:c[u];p.x=s.x,p.y=s.y}else{for(const[u,s]of Object.entries(g)){const p=a[u];p.fx=s.x,p.fy=s.y}f()}},_=g=>{var c;for(const[u,s]of Object.entries(g)){const p=this.getNodeLayout(e,u),w=(c=a==null?void 0:a[u])!=null?c:{x:0,y:0};p.value.fixed||this.options.positionFixedByDrag?(w.fx=s.x,w.fy=s.y,p.value.fixed=!0):(w.x=s.x,w.y=s.y,delete w.fx,delete w.fy)}f()},x=({node:g,event:c})=>{if(this.options.positionFixedByClickWithAltKey&&c.altKey){const u=this.getNodeLayout(e,g);let s=a==null?void 0:a[g];s||(s={id:g,x:0,y:0},a[g]=s),u.value.fixed?(delete u.value.fixed,s.x=s.fx||s.x,s.y=s.fy||s.y,delete s.fx,delete s.fy):(u.value.fixed=!0,s.fx=s.x,s.fy=s.y),f()}},v=vt(()=>[Object.keys(r.value),Object.keys(e.value),Object.values(i.value).map(g=>`${g.source}=${g.target}`),Object.values(e.value).map(g=>g.fixed)],()=>{({nodeLayouts:l,nodeLayoutMap:a}=this.buildNodeLayouts(r.value,e)),h.nodes(l);const g=h.force("edge");g&&g.links(this.forceLayoutEdges(i.value,r.value)),f()});o.on("node:dragstart",y),o.on("node:pointermove",y),o.on("node:dragend",_),o.on("node:click",x),this.onDeactivate=()=>{h.stop(),v(),o.off("node:dragstart",y),o.off("node:pointermove",y),o.off("node:dragend",_),o.off("node:click",x)}}deactivate(){this.onDeactivate&&this.onDeactivate(),this.onTick=void 0}ticked(){var n;(n=this.onTick)==null||n.call(this)}createSimulation(n,e){if(this.options.createSimulation)return this.options.createSimulation(Vt,n,e);{const r=ot(e).id(i=>i.id);return ct(n).force("edge",r.distance(100)).force("charge",ht()).force("collide",it(50).strength(.2)).force("center",et().strength(.05)).alphaMin(.001)}}buildNodeLayouts(n,e){const r=Object.keys(n).filter(l=>!(l in e.value)),i=this.forceNodeLayouts(e.value,r),o=Object.fromEntries(i.map(l=>[l.id,l]));return{nodeLayouts:i,nodeLayoutMap:o}}forceNodeLayouts(n,e){const r=Object.entries(n).map(([i,o])=>o.fixed?rn(nt({id:i},o),{fx:o.x,fy:o.y}):nt({id:i},o));return e.map(i=>({id:i})).forEach(i=>r.push(i)),r}forceLayoutEdges(n,e){return Object.values(n).filter(r=>r.source in e&&r.target in e).map(r=>({source:r.source,target:r.target}))}getNodeLayout(n,e){const r=yt(n.value,e);return r.value||(r.value={x:0,y:0}),r}}export{an as K};
